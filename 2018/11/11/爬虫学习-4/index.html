<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="爬虫,python," />










<meta name="description" content="这一章主要就是学习数据存储的相关内容。解析器解析出数据后，可以保存为txt、json、csv等文本文件，还可以保存到数据库中，比如关系型数据库MySQL、非关系型数据库MongoDB、Redis等。 文件存储文本文件存储存储为文本文件十分简单，缺点就是不便于检索。下面以一个实例来看看过程:保存知乎上“发现”页面的“热门话题”部分，将问题与答案统一保存为文本形式1234567891011121314">
<meta name="keywords" content="爬虫,python">
<meta property="og:type" content="article">
<meta property="og:title" content="爬虫学习(4)">
<meta property="og:url" content="http://yoursite.com/2018/11/11/爬虫学习-4/index.html">
<meta property="og:site_name" content="国民大可爱、">
<meta property="og:description" content="这一章主要就是学习数据存储的相关内容。解析器解析出数据后，可以保存为txt、json、csv等文本文件，还可以保存到数据库中，比如关系型数据库MySQL、非关系型数据库MongoDB、Redis等。 文件存储文本文件存储存储为文本文件十分简单，缺点就是不便于检索。下面以一个实例来看看过程:保存知乎上“发现”页面的“热门话题”部分，将问题与答案统一保存为文本形式1234567891011121314">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2018/11/11/爬虫学习-4/csv.jpg">
<meta property="og:updated_time" content="2018-11-18T07:17:13.220Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="爬虫学习(4)">
<meta name="twitter:description" content="这一章主要就是学习数据存储的相关内容。解析器解析出数据后，可以保存为txt、json、csv等文本文件，还可以保存到数据库中，比如关系型数据库MySQL、非关系型数据库MongoDB、Redis等。 文件存储文本文件存储存储为文本文件十分简单，缺点就是不便于检索。下面以一个实例来看看过程:保存知乎上“发现”页面的“热门话题”部分，将问题与答案统一保存为文本形式1234567891011121314">
<meta name="twitter:image" content="http://yoursite.com/2018/11/11/爬虫学习-4/csv.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/11/爬虫学习-4/"/>





  <title>爬虫学习(4) | 国民大可爱、</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">国民大可爱、</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Book思议在划水</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/11/爬虫学习-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Zhaoyun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="国民大可爱、">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">爬虫学习(4)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-11T17:14:46+08:00">
                2018-11-11
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/11/11/爬虫学习-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/11/11/爬虫学习-4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>这一章主要就是学习数据存储的相关内容。<br>解析器解析出数据后，可以保存为txt、json、csv等文本文件，还可以保存到数据库中，比如关系型数据库MySQL、非关系型数据库MongoDB、Redis等。</p>
<h2 id="文件存储"><a href="#文件存储" class="headerlink" title="文件存储"></a>文件存储</h2><h3 id="文本文件存储"><a href="#文本文件存储" class="headerlink" title="文本文件存储"></a>文本文件存储</h3><p>存储为文本文件十分简单，缺点就是不便于检索。<br>下面以一个实例来看看过程:保存知乎上“发现”页面的“热门话题”部分，将问题与答案统一保存为文本形式<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://www.zhihu.com/explore"</span></span><br><span class="line">headers = [</span><br><span class="line">    &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:34.0) Gecko/20100101 Firefox/34.0'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.6) Gecko/20091201 Firefox/3.5.6'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.2) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.12 Safari/535.11'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:40.0) Gecko/20100101 Firefox/40.0'</span>&#125;,</span><br><span class="line">    &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/44.0.2403.89 Chrome/44.0.2403.89 Safari/537.36'</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">html = requests.get(url,headers=random.choice(headers))</span><br><span class="line">doc = PyQuery(html.text)</span><br><span class="line">items = doc(<span class="string">'.explore-feed'</span>).items()</span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> items:</span><br><span class="line">    question = each(<span class="string">'.question_link'</span>).text()</span><br><span class="line">    author = each(<span class="string">'.author-link'</span>).text()</span><br><span class="line">    answer = PyQuery(each(<span class="string">'.content'</span>).html()).text()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'zhihu.txt'</span>,<span class="string">'a+'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">'\n'</span>.join([question,author,answer]))</span><br><span class="line">        f.write(<span class="string">'\n'</span>+<span class="string">'='</span>*<span class="number">50</span>+<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure></p>
<p>我们会得到一个叫做zhihu.txt的文本，里面保存了热门话题的问题以及回答者还有回答内容</p>
<h3 id="JSON文件存储"><a href="#JSON文件存储" class="headerlink" title="JSON文件存储"></a>JSON文件存储</h3><p>JavaScript Object Notation,即JavaScript对象标记，通过<strong>对象和数组</strong>的组合来表示数据，是一种轻量级的数据交换格式。<br>对象:{key1:value1,key2:value2,…},可以嵌套<br>数组:用[]包裹<br>一个JSON对象举例如下:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"Alice"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>:<span class="string">"female"</span>,</span><br><span class="line">    <span class="attr">"age"</span>:<span class="number">3</span></span><br><span class="line">&#125;,&#123;</span><br><span class="line">    <span class="attr">"name"</span>:<span class="string">"Bob"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>:<span class="string">"male"</span>,</span><br><span class="line">    <span class="attr">"age"</span>:<span class="number">4</span></span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure></p>
<ul>
<li>读取JSON:</li>
</ul>
<p>python提供了JSON库来实现读写操作<br>loads():将JSON文本字符串转化为JSON对象<br>dumps():将JSON对象转化为文本字符串<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment">#JSON的数据必须要双引号包围</span></span><br><span class="line">str = <span class="string">'''</span></span><br><span class="line"><span class="string">[&#123;</span></span><br><span class="line"><span class="string">    "name":"Alice",</span></span><br><span class="line"><span class="string">    "gender":"female",</span></span><br><span class="line"><span class="string">    "age":3</span></span><br><span class="line"><span class="string">&#125;,&#123;</span></span><br><span class="line"><span class="string">    "name":"Bob",</span></span><br><span class="line"><span class="string">    "gender":"male",</span></span><br><span class="line"><span class="string">    "age":4</span></span><br><span class="line"><span class="string">&#125;]</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">print(type(str))</span><br><span class="line"><span class="comment">#&lt;class 'str'&gt;</span></span><br><span class="line">data = json.loads(str)</span><br><span class="line">print(data)</span><br><span class="line">print(type(data))</span><br><span class="line"><span class="comment"># [&#123;'name': 'Alice', 'gender': 'female', 'age': 3&#125;, &#123;'name': 'Bob', 'gender': 'male', 'age': 4&#125;]</span></span><br><span class="line"><span class="comment"># &lt;class 'list'&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>注意:JSON的数据需要用双引号来包围，不能用单引号，否则loads()方法无法解析</p>
<ul>
<li>输出JSON:</li>
</ul>
<p>用dumps()方法将JSON对象转化为字符串<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line">data = [&#123;<span class="string">'name'</span>: <span class="string">'Alice'</span>, <span class="string">'gender'</span>: <span class="string">'female'</span>, <span class="string">'age'</span>: <span class="number">3</span>&#125;, &#123;<span class="string">'name'</span>: <span class="string">'Bob'</span>, <span class="string">'gender'</span>: <span class="string">'male'</span>, <span class="string">'age'</span>: <span class="number">4</span>&#125;]</span><br><span class="line">data_str = json.dumps(data)</span><br><span class="line">print(data_str)</span><br><span class="line">print(type(data_str))</span><br><span class="line"><span class="comment"># [&#123;"name": "Alice", "gender": "female", "age": 3&#125;, &#123;"name": "Bob", "gender": "male", "age": 4&#125;]</span></span><br><span class="line"><span class="comment"># &lt;class 'str'&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果要把JSON数据保存到文本中，可以在dumps中加入一个参数:indent=2,这样得到的内容会自带缩进。<br>如果JSON中包含中文，直接转换会变成unicode字符，可以在dumps中指定ensure_ascii=False，规定文件输出的编码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'data.json'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(json.dumps(data,indent=<span class="number">2</span>,ensure_ascii=<span class="keyword">False</span>))</span><br></pre></td></tr></table></figure></p>
<h3 id="CSV文件存储"><a href="#CSV文件存储" class="headerlink" title="CSV文件存储"></a>CSV文件存储</h3><p>Comma-Separated Values,逗号/字符分隔符，以纯文本形式存储<strong>表格数据</strong><br>该文件由任意数目的记录组成，记录间以某种换行符分割。</p>
<ul>
<li>写入</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> csvfile:<span class="comment">#获得文件句柄</span></span><br><span class="line">    writer = csv.writer(csvfile) <span class="comment">#初始化写入对象，传入句柄</span></span><br><span class="line">    writer.writerow([<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>])<span class="comment">#按行写入</span></span><br><span class="line">    writer.writerow([<span class="string">'10001'</span>,<span class="string">'Alice'</span>,<span class="number">3</span>])</span><br><span class="line">    writer.writerow([<span class="string">'10002'</span>,<span class="string">'Bob'</span>,<span class="number">4</span>])</span><br><span class="line"><span class="comment">#id,name,age</span></span><br><span class="line"><span class="comment">#10001,Alice,3</span></span><br><span class="line"><span class="comment">#10002,Bob,4</span></span><br></pre></td></tr></table></figure>
<p>可以看到得到的文件如下图:<br><img src="/2018/11/11/爬虫学习-4/csv.jpg" alt=""><br>写入的文本默认以<strong>逗号</strong>分隔，如果要修改列之间的分隔符，传入delimiter参数:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">writer = csv.writer(csvfile,delimiter=<span class="string">' '</span>)<span class="comment">#以空格分隔</span></span><br><span class="line"><span class="comment">#id name age</span></span><br><span class="line"><span class="comment">#10001 Alice 3</span></span><br><span class="line"><span class="comment">#10002 Bob 4</span></span><br></pre></td></tr></table></figure></p>
<p>writerow()只能一行一行写入，可以直接用writerows()同时写入多行，参数为二维列表:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">writer.writerow([<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>])</span><br><span class="line">writer.writerows([[<span class="string">'10001'</span>,<span class="string">'Alice'</span>,<span class="number">3</span>],[<span class="string">'10002'</span>,<span class="string">'Bob'</span>,<span class="number">4</span>]])</span><br></pre></td></tr></table></figure></p>
<p>不过爬虫爬取的一般都是结构化数据，一般用字典来表示，所以将数据以字典形式写进CSV:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    fieldnames = [<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>]</span><br><span class="line">    writer = csv.DictWriter(csvfile,fieldnames=fieldnames) <span class="comment">#初始化字典写入对象</span></span><br><span class="line">    writer.writeheader() <span class="comment">#可以先写入头信息</span></span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>:<span class="string">'10001'</span>,<span class="string">'name'</span>:<span class="string">'Alice'</span>,<span class="string">'age'</span>:<span class="number">3</span>&#125;)</span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>:<span class="string">'10002'</span>,<span class="string">'name'</span>:<span class="string">'Bob'</span>,<span class="string">'age'</span>:<span class="number">4</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>写入中文的话，给open()传入encoding=‘utf-8’参数即可。</p>
<ul>
<li>读取</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'data.csv'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">    reader = csv.reader(csvfile)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        print(row)</span><br><span class="line"><span class="comment"># ['id', 'name', 'age']</span></span><br><span class="line"><span class="comment"># ['10001', 'Alice', '3']</span></span><br><span class="line"><span class="comment"># ['10002', 'Bob', '4']</span></span><br></pre></td></tr></table></figure>
<p>或者用pandas:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read_csv(<span class="string">'data.csv'</span>)</span><br><span class="line">print(df)</span><br><span class="line"><span class="comment">#      id   name  age</span></span><br><span class="line"><span class="comment"># 0  10001  Alice    3</span></span><br><span class="line"><span class="comment"># 1  10002    Bob    4</span></span><br></pre></td></tr></table></figure></p>
<h2 id="关系型数据库存储"><a href="#关系型数据库存储" class="headerlink" title="关系型数据库存储"></a>关系型数据库存储</h2><p>基于关系模型的数据库，关系模型通过二维表来保存<br>关系型数据库有很多，比如SQLite、MySQL、Oracle、SQL Serve、DB2等<br>这章主要介绍的就是py3下MySQL的存储，使用PyMySQL库</p>
<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">db = pymysql.connect(host =<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">'root'</span>,port=<span class="number">3306</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">cursor.execute(<span class="string">'SELECT VERSION()'</span>)</span><br><span class="line">data = cursor.fetchone()</span><br><span class="line">print(<span class="string">'Database version:'</span>,data)</span><br><span class="line">cursor.execute(<span class="string">"CREATE DATABASE spiders DEFAULT CHARACTER SET utf8"</span>)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<p>首先用connect方法声明一个mysql链接对象，这里由于在本地运行，所以传入localhost<br>连接成功后，用cursor()方法获得mysql的操作游标，利用游标来执行sql语句，随后用execute()方法执行，然后用fetchone()方法获得第一条数据，即版本号。</p>
<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">'root'</span>,port=<span class="number">3306</span>,db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'CREATE TABLE IF NOT EXISTS students (id VARCHAR(255) NOT NULL,name VARCHAR(255) NOT NULL, age INT NOT NULL, PRIMARY KEY (id))'</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<p>在spiders数据库上创建一个名为students的表</p>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">id = <span class="string">'20120001'</span></span><br><span class="line">name = <span class="string">'Alice'</span></span><br><span class="line">age = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>,user = <span class="string">'root'</span>,password=<span class="string">'root'</span>,port=<span class="number">3306</span>,db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'INSERT INTO students(id,name,age) values(%s,%s,%s)'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql,(id,name,age))</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()<span class="comment">#数据回滚，相当于什么都没发生</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
<p>用commit()方法实现数据插入，对数据的插入、删除、更新都需要该方法<br>但上面这种写法，如果突然增加一个字段，就得改SQL语句，所以最好是有一个通用的插入方法:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="string">'20120001'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'Alice'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">keys = <span class="string">','</span>.join(data.keys())</span><br><span class="line">values = <span class="string">','</span>.join([<span class="string">'%s'</span>]*len(data))</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;)'</span>.format(table=table,keys=keys,values=values)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql,tuple(data.values())):</span><br><span class="line">        print(<span class="string">'Successful'</span>)</span><br><span class="line">        db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'Failed'</span>)</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<h3 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h3><p>如果数据存在，则更新数据，如果不存在，则插入数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">'root'</span>,port=<span class="number">3306</span>,db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'id'</span>:<span class="string">'20120001'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'Alice'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">keys = <span class="string">','</span>.join(data.keys())</span><br><span class="line">values = <span class="string">','</span>.join([<span class="string">'%s'</span>]*len(data))</span><br><span class="line">sql = <span class="string">'INSERT INTO &#123;table&#125;(&#123;keys&#125;) VALUES (&#123;values&#125;) ON DUPLICATE KEY UPDATE '</span>.format(table=table,keys=keys,values=values)</span><br><span class="line">update = <span class="string">','</span>.join([<span class="string">"&#123;key&#125;=%s"</span>.format(key=key) <span class="keyword">for</span> key <span class="keyword">in</span> data])</span><br><span class="line">sql += update</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> cursor.execute(sql,tuple(data.values())*<span class="number">2</span>):</span><br><span class="line">    print(<span class="string">'Successful'</span>)</span><br><span class="line">    db.commit()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<p>ON DUPLICATE KEY UPDATE意思就是如果如果主键已经存在，则更新数据记录，不存在则插入数据</p>
<h3 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h3><p>指定删除的目标表名和删除条件，并且要使用commit()<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">'root'</span>,port=<span class="number">3306</span>,db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">condition = <span class="string">'age &gt; 4'</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">'DELETE FROM &#123;table&#125; WHERE &#123;condition&#125;'</span>.format(table=table,condition=condition)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure></p>
<h3 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">'root'</span>,port=<span class="number">3306</span>,db=<span class="string">'spiders'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;=5'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    print(<span class="string">'Count:'</span>,cursor.rowcount)</span><br><span class="line">    one = cursor.fetchone()</span><br><span class="line">    print(<span class="string">'One:'</span>,one)</span><br><span class="line">    results = cursor.fetchall()</span><br><span class="line">    print(<span class="string">'Results:'</span>,results)</span><br><span class="line">    print(<span class="string">'Results Type:'</span>,type(results))</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> results:</span><br><span class="line">        print(row)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure>
<p>rowcount可以获取查询结果的条数<br>fetchone()是用哦你过来获取结果的第一条数据，结果是元组形式<br>fetchall()是获取所有结果的数据，但是它的内部实现是有一个指针来指向查询结果，前面已经查询了第一条数据，所以这里是从第二条数据开始查询的<br>如果想要获取所有的结果数据，可以用while+fetchone()的方法，减小开销：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">'SELECT * FROM students WHERE age &gt;=5'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    print(<span class="string">'Count:'</span>,cursor.rowcount)</span><br><span class="line">    row = cursor.fetchone()</span><br><span class="line">    <span class="keyword">while</span> row:</span><br><span class="line">        print(<span class="string">'Row:'</span>,row)</span><br><span class="line">        row = cursor.fetchone()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">'Error'</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="非关系型数据库存储"><a href="#非关系型数据库存储" class="headerlink" title="非关系型数据库存储"></a>非关系型数据库存储</h2><p>NoSQL,Not Only SQL,泛指关系型数据库。NoSQL是基于键值对的，不需要SQL层的解析，数据之间没有耦合性，性能非常高。<br>非关系型数据库可以分类如下:<br>1.键值存储数据库:Redis/Voldemort/Oracle BDB等<br>2.列存储数据库:Cassandra/HBase/Riak等<br>3.文档型数据库:CouchDB/MongoDB等<br>4.图形数据库:Neo4J/InfoGrid/Infinite Graph等<br>对于爬虫的数据存储而言，有时候某条数据的某个字段可能因为提取失败而缺失，或是要随时调整，或者数据存在嵌套关系，这种情况对于关系型数据库来说，操作很繁琐，而对于NoSQL来说就比较高效。<br>这里主要介绍了Redis和MongdoDB的数据存储操作。</p>
<h3 id="MongoDB存储"><a href="#MongoDB存储" class="headerlink" title="MongoDB存储"></a>MongoDB存储</h3><p>1.连接Mongo、指定数据库、指定集合<br>mongo中可以建立多个数据库，所以要指定操作哪个数据库<br>每个数据库包含多个集合，类似于关系数据库中的表<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="comment">#连接Mongo</span></span><br><span class="line">client = pymongo.MongoClient(host=<span class="string">'localhost'</span>,port=<span class="number">27017</span>)</span><br><span class="line"><span class="comment">#client = pymongo.MongoClient('mongodb://localhost:27017')</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定数据库test</span></span><br><span class="line">db = client.test</span><br><span class="line"><span class="comment">#db = client['test']</span></span><br><span class="line"><span class="comment">#这里要进行一个用户认证，因为在配置的时候设置了认证选项</span></span><br><span class="line">db.authenticate(<span class="string">'admin'</span>,<span class="string">'password'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定集合students</span></span><br><span class="line">collection = db.students</span><br><span class="line"><span class="comment">#collection = db['students']</span></span><br></pre></td></tr></table></figure></p>
<p>2.插入数据<br>在students集合中插入一条学生数据，该数据以字典形式表示<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">student = &#123;</span><br><span class="line">    <span class="string">'ID'</span>:<span class="string">'201810001'</span>,</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'Alice'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">3</span>,</span><br><span class="line">    <span class="string">'gender'</span>:<span class="string">'female'</span></span><br><span class="line">&#125;</span><br><span class="line">result = collection.insert(student)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment">#5bebc4875f627da9cf8e27df</span></span><br></pre></td></tr></table></figure></p>
<p>每条数据都有一个_id属性来唯一标识，insert方法执行后返回_id值<br>可以同时插入多条数据，以列表形式传递即可：collection.insert([stu1,stu2]),返回的也是_id的集合<br>不过在Mongo3.x中，更推荐使用insert_one()和insert_many()：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">result = collection.insert_one(stu1)</span><br><span class="line">print(result) <span class="comment">#返回InsertOneResult对象</span></span><br><span class="line">print(result.inserted_id) <span class="comment">#获得_id</span></span><br><span class="line"></span><br><span class="line">result = collection.insert_many([stu1,stu2])</span><br><span class="line">print(result)</span><br><span class="line">print(result.inserted_ids)</span><br></pre></td></tr></table></figure></p>
<p>3.查询<br>find_one()查询单个结果，find()返回一个生成器对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = collection.find_one(&#123;<span class="string">'name'</span>:<span class="string">'Alice'</span>&#125;)</span><br><span class="line">print(type(result))</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment">#&#123;'_id': ObjectId('5bebc3fd5f627da98d993639')</span></span><br><span class="line"><span class="comment">#'ID': '201810001', 'name': 'Alice', 'age': 3, 'gender': 'female'&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>也可以根据ObjectId看来查询，使用bson库中的objectid:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bson.objectid <span class="keyword">import</span> ObjectId</span><br><span class="line">result = collection.find_one(&#123;<span class="string">'_id'</span>:ObjectId(<span class="string">'5bebc3fd5f627da98d993639'</span>)&#125;)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment">#查询结果是字典类型，如果查询结果不存在，返回None</span></span><br><span class="line"><span class="comment">#&#123;'_id': ObjectId('5bebc4875f627da9cf8e27df'), 'ID': '201810001', 'name': 'Alice', 'age': 3, '</span></span><br></pre></td></tr></table></figure></p>
<p>查询年龄大于3的数据：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = collection.find(&#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">3</span>&#125;&#125;)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment">#&lt;pymongo.cursor.Cursor object at 0x7fa90e599940&gt;</span></span><br></pre></td></tr></table></figure></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
<th>实例</th>
</tr>
</thead>
<tbody>
<tr>
<td>$lt</td>
<td>小于</td>
<td>{‘age’:{‘$lt’:20}}</td>
</tr>
<tr>
<td>$gt</td>
<td>大于</td>
<td>{‘age’:{‘$gt’:20}}</td>
</tr>
<tr>
<td>$lte</td>
<td>小于等于</td>
<td>{‘age’:{‘$lte’:20}}</td>
</tr>
<tr>
<td>$gte</td>
<td>大于等于</td>
<td>{‘age’:{‘$gte’:20}}</td>
</tr>
<tr>
<td>$ne</td>
<td>不等于</td>
<td>{‘age’:{‘$ne’:20}}</td>
</tr>
<tr>
<td>$in</td>
<td>在范围内</td>
<td>{‘age’:{‘$in’:[20,23]}}</td>
</tr>
<tr>
<td>$nin</td>
<td>不在范围内</td>
<td>{‘age’:{‘$nin’:[20,23]}}</td>
</tr>
</tbody>
</table>
</div>
<p>也可以用正则匹配查询:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = collection.find(&#123;<span class="string">'name'</span>:&#123;<span class="string">'$regex'</span>:<span class="string">'^M*'</span>&#125;&#125;)</span><br><span class="line"><span class="comment">#查询以M开头的名字</span></span><br></pre></td></tr></table></figure></p>
<p>除了$regex,还有$exists、$type、$mod等操作，具体的可以自行查阅<br>4.计数<br>查询结果有多少条数据，可以用count()<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = collection.find().count()</span><br></pre></td></tr></table></figure></p>
<p>5.排序<br>用sort(),并传入排序的字段及升降标志<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">results = collection.find().sort(<span class="string">'ID'</span>,pymongo.DESCENDING)</span><br><span class="line">print([result[<span class="string">'ID'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br><span class="line"><span class="comment">#pymongo.ASCENDING or DESCENDING</span></span><br></pre></td></tr></table></figure></p>
<p>6.偏移<br>有时候想跳过几个元素，可以用skip()方法，偏移n个位置，就skip(n)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">results = collection.find().sort(<span class="string">'name'</span>,pymongo.ASCENDING).skip(<span class="number">30</span>)</span><br><span class="line">print([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre></td></tr></table></figure></p>
<p>也可以用limit()方法指定要取得结果个数<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">results = collection.find().sort(<span class="string">'name'</span>,pymongo.ASCENDING).skip(<span class="number">30</span>).limit(<span class="number">1</span>)<span class="comment">#只取一个</span></span><br><span class="line">print([result[<span class="string">'name'</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results])</span><br></pre></td></tr></table></figure></p>
<p>7.更新<br>update_one()或update_many(),指定更新的条件和更新后的数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">condition = &#123;<span class="string">'name'</span>:<span class="string">'Alice'</span>&#125;</span><br><span class="line">student = collection.find_one(condition)</span><br><span class="line">student[<span class="string">'age'</span>] = <span class="number">25</span></span><br><span class="line">result = collection.update_one(condition,&#123;<span class="string">'$set'</span>:student&#125;)</span><br><span class="line">print(result.matched_count,result.modified_count)</span><br><span class="line"></span><br><span class="line">condition = &#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">3</span>&#125;&#125;</span><br><span class="line">result = collection.update_many(conditon,&#123;<span class="string">'$inc'</span>:&#123;<span class="string">'age'</span>:<span class="number">1</span>&#125;&#125;) <span class="comment">#年龄+1</span></span><br></pre></td></tr></table></figure></p>
<p>8.删除<br>remove()<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">results = collection.remove(&#123;<span class="string">'name'</span>:<span class="string">'Bob'</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>不过更推荐下面的两种方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = collection.delete_one(&#123;<span class="string">'name'</span>:<span class="string">'Bob'</span>&#125;)<span class="comment">#删除第一条符合条件的数据</span></span><br><span class="line">print(result)</span><br><span class="line">print(result.delete_count)</span><br><span class="line"></span><br><span class="line">result = collection.delete_many(&#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">3</span>&#125;&#125;)<span class="comment">#删除所有符合条件的数据</span></span><br></pre></td></tr></table></figure></p>
<p>9.其他<br>pymongo还提供了一些组合方法，比如find_one_and_delete()、find_one_and_replace()等</p>
<h3 id="Redis存储"><a href="#Redis存储" class="headerlink" title="Redis存储"></a>Redis存储</h3><p>首先连接redis<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis</span><br><span class="line"><span class="comment">#host='localhost',port=6379,db=0,默认不传的情况下的值，password我们之前自己设置了</span></span><br><span class="line">redis = StrictRedis(host=<span class="string">'localhost'</span>,port=<span class="number">6379</span>,db=<span class="number">0</span>,password=<span class="string">'password'</span>)</span><br><span class="line">redis.set(<span class="string">'name'</span>,<span class="string">'Bob'</span>)</span><br><span class="line">print(redis.get(<span class="string">'name'</span>))</span><br><span class="line"><span class="comment">#b'Bob'</span></span><br></pre></td></tr></table></figure></p>
<p>还可以这样连接：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis,ConnectionPool</span><br><span class="line">pool = ConnectionPool(host=<span class="string">'localhost'</span>,port=<span class="number">6379</span>,db=<span class="number">0</span>,password=<span class="string">'password'</span>)</span><br><span class="line">redis = StrictRedis(connection_pool=pool)</span><br></pre></td></tr></table></figure></p>
<p>也可以通过构造url传给ConnectionPort：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">redis://[:password]@host:post/db #创建Redis TCP连接</span></span><br><span class="line"><span class="string">rediss://[:password]@host:post/db #创建Redis TCP+SSL</span></span><br><span class="line"><span class="string">unix://[:password]@/path/to/socket.sock?db=db #创建Redis UNIX socket连接</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis,ConnectionPool</span><br><span class="line">url = <span class="string">'redis://:password@localhost:6379/db'</span></span><br><span class="line">pool = ConnectionPool.from_url(url)</span><br><span class="line">redis = StrictRedis(connection_pool=pool)</span><br></pre></td></tr></table></figure></p>
<p>键操作:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>方法</th>
<th>作用</th>
<th>示例</th>
<th>示例结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>exists(name)</td>
<td>判断一个键是否存在</td>
<td>redis.exists(‘name’)</td>
<td>true</td>
</tr>
<tr>
<td>delete(name)</td>
<td>删除一个键</td>
<td>redis.exists(‘name’)</td>
<td>1</td>
</tr>
<tr>
<td>type(name)</td>
<td>判断键类型</td>
<td>redis.type(name)</td>
<td>b’string’</td>
</tr>
<tr>
<td>keys(pattern)</td>
<td>获取所有符合re规则的键</td>
<td>redis.keys(‘n*’)</td>
<td>[b’name’]</td>
</tr>
<tr>
<td>randomkey()</td>
<td>获取随机的一个键</td>
<td>randomkey()</td>
<td>b’name’</td>
</tr>
<tr>
<td>rename(src,dst)</td>
<td>重命名键 src:原，dst:新</td>
<td>redis.rename(‘name’,’nickname’)</td>
<td>True</td>
</tr>
<tr>
<td>dbsize()</td>
<td>获取当前数据库中键的数目</td>
<td>dbsize()</td>
<td>100</td>
</tr>
<tr>
<td>expire(name,time)</td>
<td>设定键的过期时间，单位秒</td>
<td>redis.expire(‘name’,2)</td>
<td>True</td>
</tr>
<tr>
<td>ttl(name)</td>
<td>获取键的过期时间，单位秒，-1表示永不过期</td>
<td>redis.ttl(‘name’)</td>
<td>-1</td>
</tr>
<tr>
<td>move(name,db)</td>
<td>将键移动到其他数据库</td>
<td>move(‘name’,2)</td>
<td>True</td>
</tr>
<tr>
<td>flushdb()</td>
<td>删除当前选择数据库中的所有键</td>
<td>flushdb()</td>
<td>True</td>
</tr>
<tr>
<td>flushall()</td>
<td>删除所有数据库中的所有键</td>
<td>flushall()</td>
<td>True</td>
</tr>
</tbody>
</table>
</div>
<p>这些操作太多了，需要的时候再去查就行了。</p>
<ul>
<li>字符串操作:<br>getset(name,value):给name赋值value,并返回上次的value<br>mget(keys,*args):返回多个键对应的value组成的列表，如mget([‘name’,’nickname’]) [b’mike’,b’miker’]</li>
<li>列表操作</li>
<li>集合操作</li>
<li>有序集合操作</li>
<li>散列操作</li>
</ul>
<p>RedisDump提供了强大的Redis数据导入和导出功能:<br>redis-dump用于导出数据<br>redis-load用于导入数据</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/爬虫/" rel="tag"># 爬虫</a>
          
            <a href="/tags/python/" rel="tag"># python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/07/爬虫学习-3/" rel="next" title="爬虫学习(3)">
                <i class="fa fa-chevron-left"></i> 爬虫学习(3)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/18/爬虫学习-5/" rel="prev" title="爬虫学习(5)">
                爬虫学习(5) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Chen Zhaoyun" />
            
              <p class="site-author-name" itemprop="name">Chen Zhaoyun</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#文件存储"><span class="nav-number">1.</span> <span class="nav-text">文件存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#文本文件存储"><span class="nav-number">1.1.</span> <span class="nav-text">文本文件存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSON文件存储"><span class="nav-number">1.2.</span> <span class="nav-text">JSON文件存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSV文件存储"><span class="nav-number">1.3.</span> <span class="nav-text">CSV文件存储</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关系型数据库存储"><span class="nav-number">2.</span> <span class="nav-text">关系型数据库存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#连接数据库"><span class="nav-number">2.1.</span> <span class="nav-text">连接数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建表"><span class="nav-number">2.2.</span> <span class="nav-text">创建表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#插入数据"><span class="nav-number">2.3.</span> <span class="nav-text">插入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新数据"><span class="nav-number">2.4.</span> <span class="nav-text">更新数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除数据"><span class="nav-number">2.5.</span> <span class="nav-text">删除数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询数据"><span class="nav-number">2.6.</span> <span class="nav-text">查询数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#非关系型数据库存储"><span class="nav-number">3.</span> <span class="nav-text">非关系型数据库存储</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MongoDB存储"><span class="nav-number">3.1.</span> <span class="nav-text">MongoDB存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis存储"><span class="nav-number">3.2.</span> <span class="nav-text">Redis存储</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chen Zhaoyun</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'KSn8wT5RN2dHd9qrxrtR3e0g-gzGzoHsz',
        appKey: 'DezWAMrdLtNBOzESQv1mlViN',
        placeholder: '你也上网冲浪呀',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
